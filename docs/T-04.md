# 4. Data Structure

None of the string-based identifier's properties have been specified. Whether the identifier follows specific patterns also remains a mystery, as does the minimum or maximum length.

See full code here:  [DbStructure.sql](../scripts/goals/DbStructure.sql) 

## Data

### Sales departments

Sales department characteristics:

- Should support string based identifier.
- Three-tiered hierarchy
- A product may be classified within multiple sales divisions.
- There could be more than one sales division for a given product category.

The following hierarchy must be upheld:

- The primary division.
  - The subdivision.
    - A subdivision within a subdivision.

### Product categories

Product category characteristics:
- Should support string based identifier.
- May be a member of multiple sales divisions
- A product may be classified within a singular category.

### Product

Product characteristics:

- Should support string based identifier.
- The product stays the same, but the string-based identifier can be changed easily.
- A product may be classified within multiple sales divisions.
- A product may be classified within a singular category.



## Considerations

Factors to be taken into account

As product could belong only into one category, we could consider three part product code, which helps to identify category, product and even product variations.

For product code following pattern could be used: `XXXXX-XXXXXX-XX`. Regex `[A-Z]{5}-[A-Z]{6}-[A-Z]{2}`

| Part   | Class             | Max variations |
| ------ | ----------------- | -------------- |
| XXXXX  | Category          | 456 976        |
| XXXXXX | Product           | 308 915 776    |
| XX     | Product variation | 676            |

It is designated as an *in-house identifier*. **IHI** will be the acronym. 

- `productCategoryIHI`- Category ID. (`[A-Z]{5}`)
- `productIHI` - includes product ID and variation ID. (`[A-Z]{6}-[A-Z]{2}`)

For example product category Summer Clothes has an IHI  `SUMCL` and green cotton t-shirt in the same category has IHI `TSHIRTC-GR`, then the final product IHI will be `SUMCL-TSHIRTC-GR`. In-house needs might be easily met by such code.

Through the merging of data, we can produce outputs that include a product code along with a corresponding category ID.

```sql
select concat(prd."productCategoryIHI", '-', prd."productIHI") as "productCIHI",
       "productName"
from dsr."Products" prd
```

## Structure

See full code here:  [DbStructure.sql](../scripts/goals/DbStructure.sql) 

### SalesArms

```sql
create table if not exists dsr."SalesArms"
(
    "salesArmIHI"       varchar(6)           not null
        constraint "pkSalesArms"
            primary key,
    "salesArmName"      varchar(64)          not null,
    "salesArmLevel"     dsr."SalesArmsLevel" not null,
    "salesArmParentUID" uuid,
    check ("salesArmName" !~ '^\s+' and "salesArmName" !~ '\s+$' and
           (case
                when "salesArmLevel" = 1 and "salesArmParentUID" is null
                    then true
                when "salesArmLevel" > 1 and "salesArmParentUID" is not null
                    then true
                else false end)
        )
);
```

### ProductCategories

```sql
create table if not exists dsr."ProductCategories"
(
    "productCategoryIHI"  varchar(5)   not null
        constraint "pkProductCategories"
            primary key,
    "productCategoryName" varchar(120) not null,
    check ("productCategoryIHI" !~ '^\s+'
        and "productCategoryIHI" !~ '\s+$'
        and "productCategoryName" !~ '^\s+'
        and "productCategoryName" !~ '\s+$')
);
```

### Products

```sql
create table dsr."Products"
(
    "productIHI"         varchar(6)   not null
        constraint "pkProducts"
            primary key,
    "productName"        varchar(120) not null,
    "productCategoryIHI" varchar(5)   not null,
    "productSKU"         varchar(25),
    "productUPC"         bigint,
    check ("productCategoryIHI" !~ '^\s+'
        and "productCategoryIHI" !~ '\s+$'
        and "productName" !~ '^\s+'
        and "productName" !~ '\s+$')
);
```

### SalesArmsOfProducts

```sql
create table dsr."SalesArmsOfProducts"
(
    "productSalesArmRefUID" uuid default gen_random_uuid() not null
        constraint "pkSalesArmsOfProducts"
            primary key,
    "productIHI"            varchar(6)                     not null,
    "salesArmIHI"           varchar(6)                     not null
);
```

### SalesArmsOfProductCategories

```sql
create table dsr."SalesArmsOfProductCategories"
(
    "productCategorySalesArmRefUID" uuid default gen_random_uuid() not null
        constraint "pkSalesArmsOfProductCategories"
            primary key,
    "productCategoryIHI"            varchar(5)                     not null,
    "salesArmIHI"                   varchar(6)                     not null
);
```

